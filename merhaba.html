<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Token Gösterici</title>
  <style>
    body {
      margin: 0;
      background: #1a1a1a;
      color: #f0f0f0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    .token-display {
      background: #252525;
      padding: 15px;
      border-radius: 5px;
      overflow-wrap: break-word;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
    }
    .loading {
      padding: 20px;
      text-align: center;
    }
    .error {
      color: #e74c3c;
      padding: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ATV Kanalı Token Bilgisi</h2>
    <div id="tokenResult">
      <div class="loading">Token bilgisi alınıyor...</div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // --- API ---
    const API_URL = "https://core-api.kablowebtv.com/api/channels";
    const HEADERS = {
      "User-Agent": "Mozilla/5.0",
      "Referer": "https://tvheryerde.com",
      "Origin": "https://tvheryerde.com",
      "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbnYiOiJMSVZFIiwiaXBiIjoiMCIsImNnZCI6IjA5M2Q3MjBhLTUwMmMtNDFlZC1hODBmLTJiODE2OTg0ZmI5NSIsImNzaCI6IlRSS1NUIiwiZGN0IjoiM0VGNzUiLCJkaSI6IjMwYTM5YzllLWE4ZDYtNGEwMC05NDBmLTFjMTE4NDgzZDcxMiIsInNnZCI6ImJkNmUyNmY5LWJkMzYtNDE2ZC05YWQzLTYzNjhlNGZkYTMyMiIsInNwZ2QiOiJjYjZmZGMwMi1iOGJlLTQ3MTYtYTZjYi1iZTEyYTg4YjdmMDkiLCJpY2giOiIwIiwiaWRtIjoiMCIsImlhIjoiOjpmZmZmOjEwLjAuMC4yMDYiLCJhcHYiOiIxLjAuMCIsImFibiI6IjEwMDAiLCJuYmYiOjE3NTE3MDMxODQsImV4cCI6MTc1MTcwMzI0NCwiaWF0IjoxNzUxNzAzMTg0fQ.SGC_FfT7cU1RVM4E5rMYO2IsA4aYUoYq2SXl51-PZwM"
    };

    async function fetchToken() {
      try {
        const res = await fetch(API_URL, { headers: HEADERS, method: 'GET' });
        if (!res.ok) throw new Error(`API ${res.status}`);
        
        const data = await res.json();
        if (!data.IsSucceeded || !data.Data || !data.Data.AllChannels)
          throw new Error("Geçersiz API yanıtı");

        // 'atv' kanalını bul
        const atvChannel = data.Data.AllChannels.find(ch => 
          ch && ch.StreamData && ch.StreamData.HlsStreamUrl && 
          ch.StreamData.HlsStreamUrl.includes('atv_stream')
        );
        
        if (atvChannel && atvChannel.StreamData.HlsStreamUrl) {
          const url = atvChannel.StreamData.HlsStreamUrl;
          const prefix = "https://ottcdn.kablowebtv.net/live_turksat_sub3/atv_stream/index.m3u8?wmsAuthSign=";
          
          if (url.startsWith(prefix)) {
            const token = url.substring(prefix.length);
            document.getElementById('tokenResult').innerHTML = `
              <div class="token-display">${token}</div>
            `;
          } else {
            throw new Error("ATV URL'si beklenen formatta değil");
          }
        } else {
          throw new Error("ATV kanalı veya stream URL bulunamadı");
        }
      } catch (e) {
        document.getElementById('tokenResult').innerHTML = `<div class="error">Hata: ${e.message}</div>`;
      }
    }

    fetchToken();
  });
  </script>
</body>
</html>
