<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>YouTube Player</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; }
        video { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>
    <video id="player" controls autoplay></video>

    <script>
        (async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('id');
            
            if (!videoId) return;

            try {
                // 1. YouTube'dan cookies al
                const cookieResponse = await fetch('https://corsproxy.io/?https://m.youtube.com', {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
                    }
                });

                // Cookie'leri parse et
                const cookieHeader = cookieResponse.headers.get('set-cookie') || '';
                let cookies = '';
                
                if (cookieHeader.includes('VISITOR_INFO1_LIVE=')) {
                    const match = cookieHeader.match(/VISITOR_INFO1_LIVE=([^;]+)/);
                    if (match) cookies += `VISITOR_INFO1_LIVE=${match[1]}; `;
                }
                if (cookieHeader.includes('VISITOR_PRIVACY_METADATA=')) {
                    const match = cookieHeader.match(/VISITOR_PRIVACY_METADATA=([^;]+)/);
                    if (match) cookies += `VISITOR_PRIVACY_METADATA=${match[1]}; `;
                }
                if (cookieHeader.includes('__Secure-ROLLOUT_TOKEN=')) {
                    const match = cookieHeader.match(/__Secure-ROLLOUT_TOKEN=([^;]+)/);
                    if (match) cookies += `__Secure-ROLLOUT_TOKEN=${match[1]}; `;
                }

                // 2. M3U8 URL'sini al
                const response = await fetch(`https://corsproxy.io/?https://m.youtube.com/watch?v=${videoId}&app=TABLET`, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Linux; Android 14) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.58 Mobile Safari/537.36',
                        'Cookie': cookies,
                        'X-YouTube-Client-Name': '2',
                        'X-YouTube-Client-Version': '2.20250523.01.00'
                    }
                });

                const text = await response.text();
                
                // hlsManifestUrl'yi ara
                const regex = /"hlsManifestUrl":"(https:\/\/[^"]+\.m3u8[^"]*)"/;
                const match = text.match(regex);
                
                if (match && match[1]) {
                    const m3u8Url = match[1].replace(/\\u0026/g, '&');
                    document.getElementById('player').src = m3u8Url;
                }

            } catch (error) {
                console.error('Error:', error);
            }
        })();
    </script>
</body>
</html>
