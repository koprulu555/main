<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>YouTube M3U8 Player</title>
    <style>
        body { margin: 0; padding: 0; background: #000; }
        video { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <video id="player" controls autoplay></video>

    <script>
        // URL parametrelerini al
        const urlParams = new URLSearchParams(window.location.search);
        const videoId = urlParams.get('video_id');
        const kanalId = urlParams.get('kanal_id');

        if (!videoId && !kanalId) {
            document.body.innerHTML = '<h1 style="color:white;text-align:center;">HATA: video_id veya kanal_id parametresi gerekli</h1>';
        } else {
            // M3U8 URL'sini al ve oynat
            getM3U8Url().then(m3u8Url => {
                if (m3u8Url) {
                    document.getElementById('player').src = m3u8Url;
                } else {
                    document.body.innerHTML = '<h1 style="color:white;text-align:center;">M3U8 URL bulunamadÄ±</h1>';
                }
            });
        }

        async function getM3U8Url() {
            const id = videoId || kanalId;
            const isVideo = !!videoId;
            
            try {
                // 1. Cookies al
                const cookieResponse = await fetch('https://m.youtube.com/');
                const cookieText = await cookieResponse.text();
                
                // Cookies parse et
                let visitorInfo = '', visitorMetadata = '', rolloutToken = '';
                const cookieHeader = cookieResponse.headers.get('set-cookie') || '';
                
                if (cookieHeader.includes('VISITOR_INFO1_LIVE=')) {
                    visitorInfo = cookieHeader.split('VISITOR_INFO1_LIVE=')[1].split(';')[0];
                }
                if (cookieHeader.includes('VISITOR_PRIVACY_METADATA=')) {
                    visitorMetadata = cookieHeader.split('VISITOR_PRIVACY_METADATA=')[1].split(';')[0];
                }
                if (cookieHeader.includes('__Secure-ROLLOUT_TOKEN=')) {
                    rolloutToken = cookieHeader.split('__Secure-ROLLOUT_TOKEN=')[1].split(';')[0];
                }

                // 2. M3U8 URL'sini al
                let apiUrl;
                if (isVideo) {
                    apiUrl = `https://m.youtube.com/watch?v=${id}&app=TABLET`;
                } else {
                    apiUrl = `https://m.youtube.com/channel/${id}/live?app=TABLET`;
                }

                const response = await fetch(apiUrl, {
                    headers: {
                        'Cookie': `VISITOR_INFO1_LIVE=${visitorInfo}; VISITOR_PRIVACY_METADATA=${visitorMetadata}; __Secure-ROLLOUT_TOKEN=${rolloutToken}`,
                        'User-Agent': 'Mozilla/5.0 (Linux; Android 14) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.58 Mobile Safari/537.36',
                        'X-YouTube-Client-Name': '2',
                        'X-YouTube-Client-Version': '2.20250523.01.00'
                    }
                });

                const text = await response.text();
                const cleanText = text.replace(/\\/g, '');
                
                // hlsManifestUrl'yi ara
                const regex = /"hlsManifestUrl":"([^"]+)"/;
                const match = cleanText.match(regex);
                
                if (match && match[1]) {
                    return match[1].replace(/\\u0026/g, '&');
                }
                
                return null;

            } catch (error) {
                console.error('Hata:', error);
                return null;
            }
        }
    </script>
</body>
</html>
