<script>
// Sadece API isteği için token döndür
const urlParams = new URLSearchParams(window.location.search);
const apiRequest = urlParams.get('api');

if (apiRequest) {
    (async function() {
        try {
            const API_URL = "https://core-api.kablowebtv.com/api/channels";
            const HEADERS = {
                "User-Agent": "Mozilla/5.0",
                "Referer": "https://tvheryerde.com",
                "Origin": "https://tvheryerde.com",
                "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbnYiOiJMSVZFIiwiaXBiIjoiMCIsImNnZCI6IjA5M2Q3MjBhLTUwMmMtNDFlZC1hODBmLTJiODE2OTg0ZmI5NSIsImNzaCI6IlRSS1NUIiwiZGN0IjoiRTFDNjQiLCJkaSI6Ijg5MTlmNjYwLTBhZGUtNGYwMS1hMTVlLTc2MDZjNjI4ZTc5MyIsInNnZCI6IjM5MTY0ZjIwLTZlZjUtNDRlZS04ZjAyLWEzODRjOTg1ZTY5MyIsInNwZ2QiOiI5ZjJlYWE1NC01NDM2LTQ0ZTgtYTkyNy00MzQ2NjlkMTU1MWEiLCJpY2giOiIwIiwiaWRtIjoiMCIsImlhIjoiOjpmZmZmOjEwLjAuMC41IiwiYXB2IjoiMS4wLjAiLCJhYm4iOiIxMDAwIiwibmJmIjoxNzQzNDY1MzY5LCJleHAiOjE3NDM0NjU0MjksImlhdCI6MTc0MzQ2NTM2OX0.YWdVfOL5hEZTrd4f4qkmPCPmUUlaiG7I2REW5H0p6Gw"
            };

            const res = await fetch(API_URL, { headers: HEADERS, method: 'GET' });
            if (!res.ok) throw new Error(`API ${res.status}`);
            
            const data = await res.json();
            if (!data.IsSucceeded || !data.Data || !data.Data.AllChannels)
                throw new Error("Geçersiz API yanıtı");

            const atvChannel = data.Data.AllChannels.find(ch => 
                ch && ch.StreamData && ch.StreamData.HlsStreamUrl && 
                ch.StreamData.HlsStreamUrl.includes('atv_stream')
            );
            
            if (atvChannel && atvChannel.StreamData.HlsStreamUrl) {
                const url = atvChannel.StreamData.HlsStreamUrl;
                const prefix = "https://ottcdn.kablowebtv.net/live_turksat_sub3/atv_stream/index.m3u8?wmsAuthSign=";
                
                if (url.startsWith(prefix)) {
                    const token = url.substring(prefix.length);
                    // Sadece token'i yazdır ve sayfayı kapat
                    document.write(token);
                    document.close();
                    return;
                } else {
                    throw new Error("ATV URL'si beklenen formatta değil");
                }
            } else {
                throw new Error("ATV kanalı veya stream URL bulunamadı");
            }
        } catch (e) {
            document.write('Hata: ' + e.message);
            document.close();
        }
    })();
}
</script>
<!-- Normal erişimde boş sayfa -->
